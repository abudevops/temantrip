!function(s,e){function t(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var i="selectbox",a=!1,n=!0;s.extend(t.prototype,{_isOpenSelectbox:function(s){return s?this._getInst(s).isOpen:a},_isDisabledSelectbox:function(s){return s?this._getInst(s).isDisabled:a},_attachSelectbox:function(e,t){function l(){var e,t,i=this.attr("id").split("_")[1];for(e in b._state)e!==i&&b._state.hasOwnProperty(e)&&(t=s("select[sb='"+e+"']")[0])&&b._closeSelectbox(t)}function o(){var t=!(!arguments[1]||!arguments[1].sub),i=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(a){var l,o=s(this),c=s("<li>");o.is(":selected")&&(d.text(o.text()),f=n),a===_-1&&c.addClass("last"),o.is(":disabled")||i?(l=s("<span>",{text:o.text()}).addClass(g.settings.classDisabled),t&&l.addClass(g.settings.classSub),l.appendTo(c)):(l=s("<a>",{href:"#"+o.val(),rel:o.val()}).text(o.text()).bind("click.sb",function(t){t&&t.preventDefault&&t.preventDefault();var i=r,a=s(this);i.attr("id").split("_")[1];b._changeSelectbox(e,a.attr("rel"),a.text()),b._closeSelectbox(e)}).bind("mouseover.sb",function(){var e=s(this);e.parent().siblings().find("a").removeClass(g.settings.classFocus),e.addClass(g.settings.classFocus)}).bind("mouseout.sb",function(){s(this).removeClass(g.settings.classFocus)}),t&&l.addClass(g.settings.classSub),o.is(":selected")&&l.addClass(g.settings.classFocus),l.appendTo(c)),c.appendTo(u)})}if(this._getInst(e))return a;var c,d,r,u,p=s(e),b=this,g=b._newInst(p),f=a,h=(p.find("optgroup"),p.find("option")),_=h.length;p.attr("sb",g.uid),s.extend(g.settings,b._defaults,t),b._state[g.uid]=a,p.hide(),c=s("<div>",{id:"sbHolder_"+g.uid,"class":g.settings.classHolder,tabindex:p.attr("tabindex")}),d=s("<a>",{id:"sbSelector_"+g.uid,href:"#","class":g.settings.classSelector,click:function(t){t.preventDefault(),l.apply(s(this),[]);var i=s(this).attr("id").split("_")[1];b._state[i]?b._closeSelectbox(e):b._openSelectbox(e)}}),(r=s("<a>",{id:"sbToggle_"+g.uid,href:"#","class":g.settings.classToggle,click:function(t){t.preventDefault(),l.apply(s(this),[]);var i=s(this).attr("id").split("_")[1];b._state[i]?b._closeSelectbox(e):b._openSelectbox(e)}})).appendTo(c),u=s("<ul>",{id:"sbOptions_"+g.uid,"class":g.settings.classOptions,css:{display:"none"}}),p.children().each(function(){var e,t=s(this),i={};t.is("option")?o(t):t.is("optgroup")&&(e=s("<li>"),s("<span>",{text:t.attr("label")}).addClass(g.settings.classGroup).appendTo(e),e.appendTo(u),t.is(":disabled")&&(i.disabled=!0),i.sub=!0,o(t.find("option"),i))}),f||d.text(h.first().text()),s.data(e,i,g),c.data("uid",g.uid).bind("keydown.sb",function(e){var t=e.charCode?e.charCode:e.keyCode?e.keyCode:0,a=s(this),n=a.data("uid"),l=a.siblings("select[sb='"+n+"']").data(i),o=a.siblings(["select[sb='",n,"']"].join("")).get(0),c=a.find("ul").find("a."+l.settings.classFocus);switch(t){case 37:case 38:if(c.length>0)s("a",a).removeClass(l.settings.classFocus),(d=c.parent().prevAll("li:has(a)").eq(0).find("a")).length>0&&(d.addClass(l.settings.classFocus).focus(),s("#sbSelector_"+n).text(d.text()));break;case 39:case 40:var d;s("a",a).removeClass(l.settings.classFocus),(d=c.length>0?c.parent().nextAll("li:has(a)").eq(0).find("a"):a.find("ul").find("a").eq(0)).length>0&&(d.addClass(l.settings.classFocus).focus(),s("#sbSelector_"+n).text(d.text()));break;case 13:c.length>0&&b._changeSelectbox(o,c.attr("rel"),c.text()),b._closeSelectbox(o);break;case 9:if(o)(l=b._getInst(o))&&(c.length>0&&b._changeSelectbox(o,c.attr("rel"),c.text()),b._closeSelectbox(o));var r=parseInt(a.attr("tabindex"),10);e.shiftKey?r--:r++,s("*[tabindex='"+r+"']").focus();break;case 27:b._closeSelectbox(o)}return e.stopPropagation(),!1}).delegate("a","mouseover",function(){s(this).addClass(g.settings.classFocus)}).delegate("a","mouseout",function(){s(this).removeClass(g.settings.classFocus)}),d.appendTo(c),u.appendTo(c),c.insertAfter(p),s([".",g.settings.classHolder,", .",g.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(e){var t=this._getInst(e);if(!t)return a;s("#sbHolder_"+t.uid).remove(),s.data(e,i,null),s(e).show()},_changeSelectbox:function(e,t,i){var a,l=this._getInst(e);l&&(a=this._get(l,"onChange"),s("#sbSelector_"+l.uid).text(i)),t=t.replace(/\'/g,"\\'"),s(e).find("option[value='"+t+"']").attr("selected",n),l&&a?a.apply(l.input?l.input[0]:null,[t,l]):l&&l.input&&l.input.trigger("change")},_enableSelectbox:function(e){var t=this._getInst(e);if(!t||!t.isDisabled)return a;s("#sbHolder_"+t.uid).removeClass(t.settings.classHolderDisabled),t.isDisabled=a,s.data(e,i,t)},_disableSelectbox:function(e){var t=this._getInst(e);if(!t||t.isDisabled)return a;s("#sbHolder_"+t.uid).addClass(t.settings.classHolderDisabled),t.isDisabled=n,s.data(e,i,t)},_optionSelectbox:function(e,t,n){var l=this._getInst(e);if(!l)return a;l[t]=n,s.data(e,i,l)},_openSelectbox:function(e){var t=this._getInst(e);if(t&&!t.isOpen&&!t.isDisabled){var a=s("#sbOptions_"+t.uid),l=parseInt(s(window).height(),10),o=s("#sbHolder_"+t.uid).offset(),c=s(window).scrollTop(),d=a.prev().height(),r=l-(o.top-c)-d/2,u=this._get(t,"onOpen");a.css({top:d+"px",maxHeight:r-d+"px"}),"fade"===t.settings.effect?a.fadeIn(t.settings.speed):a.slideDown(t.settings.speed),s("#sbToggle_"+t.uid).addClass(t.settings.classToggleOpen),this._state[t.uid]=n,t.isOpen=n,u&&u.apply(t.input?t.input[0]:null,[t]),s.data(e,i,t)}},_closeSelectbox:function(e){var t=this._getInst(e);if(t&&t.isOpen){var n=this._get(t,"onClose");"fade"===t.settings.effect?s("#sbOptions_"+t.uid).fadeOut(t.settings.speed):s("#sbOptions_"+t.uid).slideUp(t.settings.speed),s("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),this._state[t.uid]=a,t.isOpen=a,n&&n.apply(t.input?t.input[0]:null,[t]),s.data(e,i,t)}},_newInst:function(s){return{id:s[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:s,uid:Math.floor(99999999*Math.random()),isOpen:a,isDisabled:a,settings:{}}},_getInst:function(e){try{return s.data(e,i)}catch(t){throw"Missing instance data for this selectbox"}},_get:function(s,t){return s.settings[t]!==e?s.settings[t]:this._defaults[t]}}),s.fn.selectbox=function(e){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&"isDisabled"==e?s.selectbox["_"+e+"Selectbox"].apply(s.selectbox,[this[0]].concat(t)):"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?s.selectbox["_"+e+"Selectbox"].apply(s.selectbox,[this[0]].concat(t)):this.each(function(){"string"==typeof e?s.selectbox["_"+e+"Selectbox"].apply(s.selectbox,[this].concat(t)):s.selectbox._attachSelectbox(this,e)})},s.selectbox=new t,s.selectbox.version="0.2"}(jQuery);